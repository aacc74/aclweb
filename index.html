<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empanadas Deliciosas | Sistema de Pedidos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... (todos los estilos anteriores se mantienen igual) ... */
        
        /* Nuevos estilos para notificaciones */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: var(--shadow);
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .remove-admin {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <!-- ... (resto del código HTML se mantiene igual) ... -->
    
    <script>
        // ... (configuración de Firebase y variables globales) ...
        
        // Observador de autenticación
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                // ... (código existente) ...
                
                // Cargar usuarios administradores
                loadAdminUsers();
            } else {
                // ... (código existente) ...
            }
        });
        
        // 1. Cargar usuarios administradores desde Firestore
        function loadAdminUsers() {
            db.collection("adminUsers").get()
            .then(querySnapshot => {
                adminUsers = [];
                querySnapshot.forEach(doc => {
                    adminUsers.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                renderAdminUsers();
                
                // Verificar si el usuario actual es administrador
                checkAdminStatus(currentUser);
            })
            .catch(error => {
                console.error("Error cargando usuarios administradores: ", error);
                showNotification('Error al cargar usuarios administradores', true);
            });
        }
        
        // 2. Renderizar usuarios administradores
        function renderAdminUsers() {
            adminUsersList.innerHTML = '';
            regularUsersList.innerHTML = '';
            
            // Agregar administradores
            adminUsers.forEach(admin => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card admin';
                userCard.innerHTML = `
                    <img src="https://via.placeholder.com/60" alt="${admin.email}" class="user-avatar">
                    <div class="user-details">
                        <h4>${admin.email}</h4>
                        <div class="role-badge role-admin">Administrador</div>
                        <p><small>Agregado por: ${admin.addedBy}</small></p>
                    </div>
                    <button class="remove-admin" data-id="${admin.id}">
                        <i class="fas fa-times" style="color: var(--danger);"></i>
                    </button>
                `;
                adminUsersList.appendChild(userCard);
            });
            
            // Agregar event listeners para eliminar administradores
            document.querySelectorAll('.remove-admin').forEach(button => {
                button.addEventListener('click', (e) => {
                    const adminId = e.target.closest('.remove-admin').dataset.id;
                    removeAdmin(adminId);
                });
            });
        }
        
        // 3. Comprobar si el usuario es administrador
        function checkAdminStatus(user) {
            if (!user) return false;
            
            // Verificar si el usuario está en la lista de administradores
            const isAdmin = adminUsers.some(admin => admin.email === user.email);
            
            // Actualizar la interfaz según el rol
            showAdminSection(isAdmin);
            
            return isAdmin;
        }
        
        // 4. Mostrar/ocultar sección de administración
        function showAdminSection(show) {
            const adminNavItem = document.querySelector('nav li a[data-section="admin"]').parentElement;
            adminNavItem.style.display = show ? 'block' : 'none';
            
            if (show) {
                document.getElementById('adminSection').style.display = 'block';
            } else {
                document.getElementById('adminSection').style.display = 'none';
            }
        }
        
        // 5. Agregar un nuevo administrador
        function addAdmin(email) {
            // Validar formato de email
            if (!isValidEmail(email)) {
                showNotification('Por favor, ingrese un email válido', true);
                return;
            }
            
            // Verificar si el usuario ya es administrador
            if (adminUsers.some(admin => admin.email === email)) {
                showNotification('Este usuario ya es administrador', true);
                return;
            }
            
            // Agregar a la colección de administradores
            db.collection("adminUsers").add({
                email: email,
                addedBy: currentUser.email,
                addedAt: new Date().toISOString()
            })
            .then(() => {
                showNotification('Administrador agregado correctamente');
                loadAdminUsers();
            })
            .catch(error => {
                console.error("Error agregando administrador: ", error);
                showNotification('Error al agregar administrador', true);
            });
        }
        
        // 6. Eliminar un administrador
        function removeAdmin(adminId) {
            if (confirm('¿Estás seguro de que deseas eliminar este administrador?')) {
                db.collection("adminUsers").doc(adminId).delete()
                .then(() => {
                    showNotification('Administrador eliminado correctamente');
                    loadAdminUsers();
                })
                .catch(error => {
                    console.error("Error eliminando administrador: ", error);
                    showNotification('Error al eliminar administrador', true);
                });
            }
        }
        
        // 7. Función para validar emails
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // 8. Mostrar notificación
        function showNotification(message, isError = false) {
            const notification = document.createElement('div');
            notification.className = `notification ${isError ? 'error' : ''}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animación de entrada
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // En setupEventListeners, agregar el evento para el formulario de admin
        function setupEventListeners() {
            // ... (otros event listeners) ...
            
            // Formulario para agregar administrador
            addAdminForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('adminEmail').value;
                addAdmin(email);
                addAdminForm.reset();
            });
        }
        
        // Al inicio del script, agregar el elemento de navegación para admin
        document.addEventListener('DOMContentLoaded', () => {
            // Crear enlace de administración
            const nav = document.querySelector('nav ul');
            const adminLink = document.createElement('li');
            adminLink.innerHTML = `
                <a href="#" data-section="admin">Administración</a>
            `;
            nav.appendChild(adminLink);
            adminLink.style.display = 'none'; // Ocultar inicialmente
            
            setupEventListeners();
        });
    </script>
</body>
</html>